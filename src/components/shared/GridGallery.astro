---
import HoverImage from "@components/shared/HoverImage.astro";
import type { ImageMetadata } from "astro";

interface Props {
    images: ImageMetadata[];
    altPrefix?: string;
}

const { images, altPrefix = "Gallery image" } = Astro.props;
---

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10 gallery-grid">
    {
        images.map((src, index) => (
            <div class="gallery-item opacity-0">
                <div class="aspect-[3/4] w-full overflow-hidden">
                    <HoverImage
                        src={src}
                        alt={`${altPrefix} ${index + 1}`}
                        className="h-full object-cover"
                    />
                </div>
            </div>
        ))
    }
</div>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    gsap.registerPlugin(ScrollTrigger);

    const galleryGrids = document.querySelectorAll(".gallery-grid");

    galleryGrids.forEach((grid) => {
        const items = grid.querySelectorAll(".gallery-item");

        gsap.fromTo(
            items,
            {
                opacity: 0,
                scale: 0.8,
                y: 100,
            },
            {
                opacity: 1,
                scale: 1,
                y: 0,
                duration: 1.2,
                stagger: {
                    amount: 0.8,
                    from: "random",
                },
                ease: "power3.out",
                scrollTrigger: {
                    trigger: grid,
                    start: "top bottom-=10%",
                    end: "bottom center",
                    toggleActions: "play none none reverse",
                },
            }
        );
    });
</script>

<style>
    .gallery-item {
        will-change: transform, opacity;
    }
</style>
